{"version":3,"file":"power-select.js","sources":["../../src/components/power-select.ts"],"sourcesContent":["import Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { action, get } from '@ember/object';\nimport { guidFor } from '@ember/object/internals';\nimport { addObserver, removeObserver } from '@ember/object/observers';\nimport { scheduleTask } from 'ember-lifeline';\nimport { isEqual, isNone } from '@ember/utils';\nimport { assert, deprecate } from '@ember/debug';\nimport {\n  indexOfOption,\n  filterOptions,\n  findOptionWithOffset,\n  countOptions,\n  defaultHighlighted,\n  advanceSelectableOption,\n  defaultMatcher,\n  defaultTypeAheadMatcher,\n  pathForOption,\n  type MatcherFn,\n} from '../utils/group-utils.ts';\nimport { restartableTask, timeout } from 'ember-concurrency';\nimport { modifier } from 'ember-modifier';\nimport type {\n  Dropdown,\n  DropdownActions,\n  TRootEventType,\n} from 'ember-basic-dropdown/components/basic-dropdown';\nimport Owner from '@ember/application';\nimport type { CalculatePosition } from 'ember-basic-dropdown/utils/calculate-position';\nimport { isArray } from '@ember/array';\nimport type { ComponentLike } from '@glint/template';\n\ninterface SelectActions extends DropdownActions {\n  search: (term: string) => void;\n  highlight: (option: any) => void;\n  select: (selected: any, e?: Event) => void;\n  choose: (selected: any, e?: Event) => void;\n  scrollTo: (option: any) => void;\n  labelClick: (e: MouseEvent) => void;\n}\nexport interface Select extends Dropdown {\n  selected: any;\n  highlighted: any;\n  options: readonly any[];\n  results: readonly any[];\n  resultsCount: number;\n  loading: boolean;\n  isActive: boolean;\n  searchText: string;\n  lastSearchedText: string;\n  actions: SelectActions;\n}\ninterface PromiseProxy<T> extends Promise<T> {\n  content: any;\n}\ninterface CancellablePromise<T> extends Promise<T> {\n  cancel: () => void;\n}\ninterface Sliceable<T> {\n  slice(): T[];\n}\n// Some args are not listed here because they are only accessed from the template. Should I list them?\nexport interface PowerSelectArgs {\n  highlightOnHover?: boolean;\n  placeholderComponent?: string | ComponentLike<any>;\n  searchMessage?: string;\n  searchMessageComponent?: string | ComponentLike<any>;\n  noMatchesMessage?: string;\n  noMatchesMessageComponent?: string | ComponentLike<any>;\n  matchTriggerWidth?: boolean;\n  resultCountMessage?: (resultCount: number) => string;\n  options?: readonly any[] | Promise<readonly any[]>;\n  selected?: any | PromiseProxy<any>;\n  destination?: string;\n  closeOnSelect?: boolean;\n  renderInPlace?: boolean;\n  preventScroll?: boolean;\n  defaultHighlighted?: any;\n  searchField?: string;\n  labelClass?: string;\n  labelText?: string;\n  labelClickAction?: TLabelClickAction;\n  ariaLabel?: string;\n  ariaLabelledBy?: string;\n  loadingMessage?: string;\n  placeholder?: string;\n  dropdownClass?: string;\n  allowClear?: boolean;\n  searchEnabled?: boolean;\n  animationEnabled?: boolean;\n  tabindex?: number | string;\n  searchPlaceholder?: string;\n  verticalPosition?: string;\n  horizontalPosition?: string;\n  triggerId?: string;\n  disabled?: boolean;\n  title?: string;\n  triggerRole?: string;\n  required?: string;\n  triggerClass?: string;\n  ariaInvalid?: string;\n  eventType?: string;\n  rootEventType?: TRootEventType;\n  ariaDescribedBy?: string;\n  calculatePosition?: CalculatePosition;\n  ebdTriggerComponent?: string | ComponentLike<any>;\n  ebdContentComponent?: string | ComponentLike<any>;\n  labelComponent?: string | ComponentLike<any>;\n  triggerComponent?: string | ComponentLike<any>;\n  selectedItemComponent?: string | ComponentLike<any>;\n  beforeOptionsComponent?: string | ComponentLike<any>;\n  optionsComponent?: string | ComponentLike<any>;\n  groupComponent?: string | ComponentLike<any>;\n  afterOptionsComponent?: string | ComponentLike<any>;\n  extra?: any;\n  matcher?: MatcherFn;\n  initiallyOpened?: boolean;\n  typeAheadOptionMatcher?: MatcherFn;\n  buildSelection?: (selected: any, select: Select) => any;\n  onChange: (selection: any, select: Select, event?: Event) => void;\n  search?: (\n    term: string,\n    select: Select,\n  ) => readonly any[] | Promise<readonly any[]>;\n  onOpen?: (select: Select, e: Event) => boolean | undefined;\n  onClose?: (select: Select, e: Event) => boolean | undefined;\n  onInput?: (term: string, select: Select, e: Event) => string | false | void;\n  onKeydown?: (select: Select, e: KeyboardEvent) => boolean | undefined;\n  onFocus?: (select: Select, event: FocusEvent) => void;\n  onBlur?: (select: Select, event: FocusEvent) => void;\n  scrollTo?: (option: any, select: Select) => void;\n  registerAPI?: (select: Select) => void;\n}\n\nexport type TLabelClickAction = 'focus' | 'open';\n\nexport interface PowerSelectSignature {\n  Element: HTMLElement;\n  Args: PowerSelectArgs;\n  Blocks: {\n    default: [option: any, select: Select];\n  };\n}\n\nconst isSliceable = <T>(coll: any): coll is Sliceable<T> => {\n  return isArray(coll);\n};\n\nconst isPromiseLike = <T>(thing: any): thing is Promise<T> => {\n  return typeof thing.then === 'function';\n};\n\nconst isPromiseProxyLike = <T>(thing: any): thing is PromiseProxy<T> => {\n  return isPromiseLike(thing) && Object.hasOwnProperty.call(thing, 'content');\n};\n\nconst isCancellablePromise = <T>(\n  thing: any,\n): thing is CancellablePromise<T> => {\n  return typeof thing.cancel === 'function';\n};\n\nexport default class PowerSelectComponent extends Component<PowerSelectSignature> {\n  // Untracked properties\n  _publicAPIActions = {\n    search: this._search,\n    highlight: this._highlight,\n    select: this._select,\n    choose: this._choose,\n    scrollTo: this._scrollTo,\n    labelClick: this._labelClick,\n  };\n\n  // Tracked properties\n  @tracked private _resolvedOptions?: readonly any[];\n  @tracked private _resolvedSelected?: any;\n  @tracked private _repeatingChar = '';\n  @tracked private _expirableSearchText = '';\n  @tracked private _searchResult?: readonly any[];\n  @tracked isActive = false;\n  @tracked loading = false;\n  @tracked searchText = '';\n  @tracked lastSearchedText = '';\n  @tracked highlighted?: any;\n  storedAPI!: Select;\n\n  private _uid = guidFor(this);\n  private _lastOptionsPromise?: Promise<readonly any[]>;\n  private _lastSelectedPromise?: PromiseProxy<any>;\n  private _lastSearchPromise?:\n    | Promise<readonly any[]>\n    | CancellablePromise<readonly any[]>;\n  private _filterResultsCache: {\n    results: any[];\n    options: any[];\n    searchText: string;\n  } = { results: [], options: [], searchText: this.searchText };\n\n  // Lifecycle hooks\n  constructor(owner: Owner, args: PowerSelectArgs) {\n    super(owner, args);\n    assert(\n      '<PowerSelect> requires an `@onChange` function',\n      this.args.onChange && typeof this.args.onChange === 'function',\n    );\n  }\n\n  willDestroy() {\n    if (\n      this._lastSelectedPromise &&\n      isPromiseProxyLike(this._lastSelectedPromise)\n    ) {\n      try {\n        removeObserver(\n          this._lastSelectedPromise,\n          'content',\n          this,\n          this._selectedObserverCallback,\n        );\n        // eslint-disable-next-line no-empty\n      } catch {}\n      this._lastSelectedPromise = undefined;\n    }\n    super.willDestroy();\n  }\n\n  // Getters\n  get highlightOnHover(): boolean {\n    return this.args.highlightOnHover === undefined\n      ? true\n      : this.args.highlightOnHover;\n  }\n\n  get labelClickAction(): TLabelClickAction {\n    return this.args.labelClickAction === undefined\n      ? 'focus'\n      : this.args.labelClickAction;\n  }\n\n  get highlightedIndex(): string {\n    const results = this.results;\n    const highlighted = this.highlighted;\n    return pathForOption(results, highlighted);\n  }\n\n  get searchMessage(): string {\n    return this.args.searchMessage === undefined\n      ? 'Type to search'\n      : this.args.searchMessage;\n  }\n\n  get noMatchesMessage(): string {\n    return this.args.noMatchesMessage === undefined\n      ? 'No results found'\n      : this.args.noMatchesMessage;\n  }\n\n  get resultCountMessage(): string {\n    if (typeof this.args.resultCountMessage === 'function') {\n      return this.args.resultCountMessage(this.resultsCount);\n    }\n\n    if (this.resultsCount === 1) {\n      return `${this.resultsCount} result`;\n    }\n\n    return `${this.resultsCount} results`;\n  }\n\n  get matchTriggerWidth() {\n    return this.args.matchTriggerWidth === undefined\n      ? true\n      : this.args.matchTriggerWidth;\n  }\n\n  get mustShowSearchMessage(): boolean {\n    return (\n      !this.loading &&\n      this.searchText.length === 0 &&\n      !!this.args.search &&\n      !!this.searchMessage &&\n      this.resultsCount === 0\n    );\n  }\n\n  get mustShowNoMessages(): boolean {\n    return (\n      !this.loading &&\n      this.resultsCount === 0 &&\n      (!this.args.search || this.lastSearchedText.length > 0)\n    );\n  }\n\n  get results(): any[] {\n    if (this.searchText.length > 0) {\n      if (this.args.search) {\n        return toPlainArray(this._searchResult || this.options);\n      } else {\n        if (\n          this._filterResultsCache.options === this.options &&\n          this._filterResultsCache.searchText === this.searchText\n        ) {\n          // This is an optimization to avoid filtering several times, which may be a bit expensive\n          // if there are many options, if neither the options nor the searchtext have changed\n          return this._filterResultsCache.results;\n        }\n        const results = this._filter(this.options, this.searchText);\n        // eslint-disable-next-line ember/no-side-effects\n        this._filterResultsCache = {\n          results,\n          options: this.options,\n          searchText: this.searchText,\n        };\n        return results;\n      }\n    } else {\n      return this.options;\n    }\n  }\n\n  get options(): any[] {\n    if (this._resolvedOptions) return toPlainArray(this._resolvedOptions);\n    if (this.args.options) {\n      return toPlainArray(this.args.options as any[]);\n    } else {\n      return [];\n    }\n  }\n\n  get resultsCount(): number {\n    return countOptions(this.results);\n  }\n\n  get selected(): any {\n    if (this._resolvedSelected) {\n      return toPlainArray(this._resolvedSelected);\n    } else if (\n      !isNone(this.args.selected) &&\n      typeof this.args.selected.then !== 'function'\n    ) {\n      return toPlainArray(this.args.selected);\n    }\n    return undefined;\n  }\n\n  get ariaMultiSelectable(): boolean {\n    return isArray(this.args.selected);\n  }\n\n  get triggerId(): string {\n    return this.args.triggerId || `${this._uid}-trigger`;\n  }\n\n  get labelId(): string {\n    return `${this._uid}-label`;\n  }\n\n  get ariaLabelledBy(): string {\n    if (this.args.ariaLabelledBy) {\n      return this.args.ariaLabelledBy;\n    }\n\n    if (this.args.labelText || this.args.labelComponent) {\n      return this.labelId;\n    }\n\n    return '';\n  }\n\n  // Actions\n  @action\n  handleOpen(_select: Select, e: Event): boolean | void {\n    if (this.args.onOpen && this.args.onOpen(this.storedAPI, e) === false) {\n      return false;\n    }\n    if (e) {\n      if (\n        e instanceof KeyboardEvent &&\n        e.type === 'keydown' &&\n        (e.keyCode === 38 || e.keyCode === 40)\n      ) {\n        e.preventDefault();\n      }\n    }\n    this._resetHighlighted();\n  }\n\n  @action\n  handleClose(_select: Select, e: Event): boolean | void {\n    if (this.args.onClose && this.args.onClose(this.storedAPI, e) === false) {\n      return false;\n    }\n    this._highlight(undefined);\n  }\n\n  @action\n  handleInput(e: InputEvent): void {\n    if (e.target === null) return;\n    const term = (e.target as HTMLInputElement).value;\n    let correctedTerm;\n    if (this.args.onInput) {\n      correctedTerm = this.args.onInput(term, this.storedAPI, e);\n      if (correctedTerm === false) {\n        return;\n      }\n    }\n    this._publicAPIActions.search(\n      typeof correctedTerm === 'string' ? correctedTerm : term,\n    );\n  }\n\n  @action\n  handleKeydown(e: KeyboardEvent) {\n    if (\n      this.args.onKeydown &&\n      this.args.onKeydown(this.storedAPI, e) === false\n    ) {\n      return false;\n    }\n    return this._routeKeydown(this.storedAPI, e);\n  }\n\n  @action\n  handleTriggerKeydown(e: KeyboardEvent) {\n    if (\n      this.args.onKeydown &&\n      this.args.onKeydown(this.storedAPI, e) === false\n    ) {\n      e.stopImmediatePropagation();\n      return;\n    }\n    if (e.ctrlKey || e.metaKey) {\n      e.stopImmediatePropagation();\n      return;\n    }\n    if ((e.keyCode >= 48 && e.keyCode <= 90) || isNumpadKeyEvent(e)) {\n      // Keys 0-9, a-z or numpad keys\n      this.triggerTypingTask.perform(e);\n    } else if (e.keyCode === 32) {\n      // Space\n      this._handleKeySpace(this.storedAPI, e);\n    } else {\n      return this._routeKeydown(this.storedAPI, e);\n    }\n  }\n\n  @action\n  _labelClick(event: MouseEvent) {\n    if (!this.storedAPI) {\n      return;\n    }\n\n    // Double-click, do nothing\n    if (event.detail > 1) {\n      return;\n    }\n\n    if (this.labelClickAction === 'open') {\n      this.storedAPI.actions.open();\n      return;\n    } else if (this.labelClickAction === 'focus') {\n      const trigger = document.querySelector(\n        `[data-ebd-id=\"${this.storedAPI.uniqueId}-trigger\"]`,\n      ) as HTMLElement;\n\n      if (!trigger) {\n        return;\n      }\n\n      trigger.focus();\n    }\n\n    return true;\n  }\n\n  @action\n  handleFocus(event: FocusEvent): void {\n    if (!this.isDestroying) {\n      scheduleTask(this, 'actions', this._updateIsActive, true);\n    }\n    if (this.args.onFocus) {\n      this.args.onFocus(this.storedAPI, event);\n    }\n  }\n\n  @action\n  handleBlur(event: FocusEvent): void {\n    if (!this.isDestroying) {\n      scheduleTask(this, 'actions', this._updateIsActive, false);\n    }\n    if (this.args.onBlur) {\n      this.args.onBlur(this.storedAPI, event);\n    }\n  }\n\n  // Methods\n  @action\n  _search(term: string): void {\n    if (this.searchText === term) return;\n    this.searchText = term;\n    if (!this.args.search) {\n      this.lastSearchedText = term;\n      this._resetHighlighted();\n    }\n  }\n\n  @action\n  _updateOptions(): void {\n    deprecate(\n      'You are using power-select with ember/render-modifier. Replace {{did-insert this._updateOptions @options}} and {{did-update this._updateOptions @options}} with {{this.updateOptions @options}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this.__updateOptions();\n  }\n\n  @action\n  _updateHighlighted(): void {\n    if (this.storedAPI.isOpen) {\n      this._resetHighlighted();\n    }\n  }\n\n  @action\n  _updateSelected(): void {\n    deprecate(\n      'You are using power-select with ember/render-modifier. Replace {{did-insert this._updateSelected @selected}} and {{did-update this._updateSelected @selected}} with {{this.updateSelected @selected}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this.__updateSelected();\n  }\n\n  _selectedObserverCallback(): void {\n    this._resolvedSelected = this._lastSelectedPromise;\n    this._highlight(this._resolvedSelected);\n  }\n\n  @action\n  _highlight(opt: any): void {\n    if (!isNone(opt) && opt.disabled) {\n      return;\n    }\n    this.highlighted = opt;\n  }\n\n  @action\n  _select(selected: any, e?: Event): void {\n    if (!isEqual(this.storedAPI.selected, selected)) {\n      this.args.onChange(selected, this.storedAPI, e);\n    }\n  }\n\n  @action\n  _choose(selected: any, e?: Event): void {\n    const selection = this.args.buildSelection\n      ? this.args.buildSelection(selected, this.storedAPI)\n      : selected;\n    this.storedAPI.actions.select(selection, e);\n    if (this.args.closeOnSelect !== false) {\n      this.storedAPI.actions.close(e);\n      // return false;\n    }\n  }\n\n  @action\n  _scrollTo(option: any): void {\n    const select = this.storedAPI;\n    if (!document || !option) {\n      return;\n    }\n    if (this.args.scrollTo) {\n      return this.args.scrollTo(option, select);\n    }\n    const optionsList = document.getElementById(\n      `ember-power-select-options-${select.uniqueId}`,\n    ) as HTMLElement;\n    if (!optionsList) {\n      return;\n    }\n    const index = indexOfOption(select.results, option);\n    if (index === -1) {\n      return;\n    }\n    const optionElement = optionsList.querySelector(\n      `[data-option-index='${index}']`,\n    ) as HTMLElement;\n    if (!optionElement) {\n      return;\n    }\n    const optionTopScroll = optionElement.offsetTop - optionsList.offsetTop;\n    const optionBottomScroll = optionTopScroll + optionElement.offsetHeight;\n    if (optionBottomScroll > optionsList.offsetHeight + optionsList.scrollTop) {\n      optionsList.scrollTop = optionBottomScroll - optionsList.offsetHeight;\n    } else if (optionTopScroll < optionsList.scrollTop) {\n      optionsList.scrollTop = optionTopScroll;\n    }\n  }\n\n  @action\n  _registerAPI(triggerElement: Element, [publicAPI]: [Select]): void {\n    deprecate(\n      'You are using power-select with ember/render-modifier. Replace {{did-insert this._registerAPI publicAPI}} and {{did-update this._registerAPI publicAPI}} with {{this.updateRegisterAPI publicAPI}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this.__registerAPI(triggerElement, [publicAPI]);\n  }\n\n  @action\n  _performSearch(triggerElement: Element, [term]: [string]): void {\n    deprecate(\n      'You are using power-select with ember/render-modifier. Replace {{did-update this._performSearch this.searchText}} with {{this.updatePerformSearch this.searchText}}.',\n      false,\n      {\n        for: 'ember-power-select',\n        id: 'ember-power-select.no-at-ember-render-modifiers',\n        since: {\n          enabled: '8.1',\n          available: '8.1',\n        },\n        until: '9.0.0',\n      },\n    );\n\n    this.__performSearch(triggerElement, [term]);\n  }\n\n  updateOptions = modifier(\n    () => {\n      this.__updateOptions();\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  updateSelected = modifier(\n    () => {\n      this.__updateSelected();\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  updateRegisterAPI = modifier(\n    (triggerElement: Element, [publicAPI]: [Select]) => {\n      this.__registerAPI(triggerElement, [publicAPI]);\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  updatePerformSearch = modifier(\n    (triggerElement: Element, [term]: [string]) => {\n      this.__performSearch(triggerElement, [term]);\n    },\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    { eager: false },\n  );\n\n  private __updateOptions() {\n    if (!this.args.options) return;\n    if (isPromiseLike(this.args.options)) {\n      if (this._lastOptionsPromise === this.args.options) return; // promise is still the same\n      const currentOptionsPromise = this.args.options;\n      this._lastOptionsPromise = currentOptionsPromise;\n      this.loading = true;\n      this._lastOptionsPromise\n        .then((resolvedOptions) => {\n          if (this._lastOptionsPromise === currentOptionsPromise) {\n            this.loading = false;\n            this._resolvedOptions = resolvedOptions;\n            this._resetHighlighted();\n          }\n        })\n        .catch(() => {\n          if (this._lastOptionsPromise === currentOptionsPromise) {\n            this.loading = false;\n          }\n        });\n    } else {\n      scheduleTask(this, 'actions', this._resetHighlighted);\n    }\n  }\n\n  private __updateSelected(): void {\n    if (isNone(this.args.selected)) return;\n    if (typeof this.args.selected.then === 'function') {\n      if (this._lastSelectedPromise === this.args.selected) return; // promise is still the same\n      if (\n        this._lastSelectedPromise &&\n        isPromiseProxyLike(this._lastSelectedPromise)\n      ) {\n        removeObserver(\n          this._lastSelectedPromise,\n          'content',\n          this,\n          this._selectedObserverCallback,\n        );\n      }\n\n      const currentSelectedPromise: PromiseProxy<any> = this.args.selected;\n      currentSelectedPromise.then(() => {\n        if (this.isDestroyed || this.isDestroying) return;\n        if (isPromiseProxyLike(currentSelectedPromise)) {\n          // eslint-disable-next-line ember/no-observers\n          addObserver(\n            currentSelectedPromise,\n            'content',\n            this,\n            this._selectedObserverCallback,\n          );\n        }\n      });\n\n      this._lastSelectedPromise = currentSelectedPromise;\n      this._lastSelectedPromise.then((resolvedSelected) => {\n        if (this._lastSelectedPromise === currentSelectedPromise) {\n          this._resolvedSelected = resolvedSelected;\n          this._highlight(resolvedSelected);\n        }\n      });\n    } else {\n      this._resolvedSelected = undefined;\n      // Don't highlight args.selected array on multi-select\n      if (!Array.isArray(this.args.selected)) {\n        this._highlight(this.args.selected);\n      }\n    }\n  }\n\n  private __registerAPI(_: Element, [publicAPI]: [Select]): void {\n    this.storedAPI = publicAPI;\n    if (this.args.registerAPI) {\n      scheduleTask(this, 'actions', this.args.registerAPI, publicAPI);\n    }\n  }\n\n  private __performSearch(_: Element, [term]: [string]): void {\n    if (!this.args.search) return;\n    if (term === '') {\n      this.loading = false;\n      this.lastSearchedText = term;\n      if (this._lastSearchPromise !== undefined) {\n        if (isCancellablePromise(this._lastSearchPromise)) {\n          this._lastSearchPromise.cancel(); // Cancel ember-concurrency tasks\n        }\n        this._lastSearchPromise = undefined;\n      }\n      return;\n    }\n    const searchResult = this.args.search(term, this.storedAPI);\n    if (searchResult && isPromiseLike(searchResult)) {\n      this.loading = true;\n      if (\n        this._lastSearchPromise !== undefined &&\n        isCancellablePromise(this._lastSearchPromise)\n      ) {\n        this._lastSearchPromise.cancel(); // Cancel ember-concurrency tasks\n      }\n      this._lastSearchPromise = searchResult;\n      searchResult\n        .then((results) => {\n          if (this._lastSearchPromise === searchResult) {\n            this._searchResult = results;\n            this.loading = false;\n            this.lastSearchedText = term;\n            scheduleTask(this, 'actions', this._resetHighlighted);\n          }\n        })\n        .catch(() => {\n          if (this._lastSearchPromise === searchResult) {\n            this.loading = false;\n            this.lastSearchedText = term;\n          }\n        });\n    } else {\n      this.lastSearchedText = term;\n      this._searchResult = searchResult;\n      scheduleTask(this, 'actions', this._resetHighlighted);\n    }\n  }\n\n  _defaultBuildSelection(option: any): any {\n    return option;\n  }\n\n  _routeKeydown(select: Select, e: KeyboardEvent): boolean | void {\n    if (e.keyCode === 38 || e.keyCode === 40) {\n      // Up & Down\n      return this._handleKeyUpDown(select, e);\n    } else if (e.keyCode === 13) {\n      // ENTER\n      return this._handleKeyEnter(select, e);\n    } else if (e.keyCode === 9) {\n      // Tab\n      return this._handleKeyTab(select, e);\n    } else if (e.keyCode === 27) {\n      // ESC\n      return this._handleKeyESC(select, e);\n    }\n  }\n\n  _handleKeyTab(select: Select, e: KeyboardEvent): void {\n    select.actions.close(e);\n  }\n\n  _handleKeyESC(select: Select, e: KeyboardEvent): void {\n    select.actions.close(e);\n  }\n\n  _handleKeyEnter(select: Select, e: KeyboardEvent): boolean | void {\n    if (select.isOpen && select.highlighted !== undefined) {\n      select.actions.choose(select.highlighted, e);\n      e.stopImmediatePropagation();\n      return false;\n    }\n  }\n\n  _handleKeySpace(select: Select, e: KeyboardEvent): void {\n    if (\n      e.target !== null &&\n      ['TEXTAREA', 'INPUT'].includes((e.target as Element).nodeName)\n    ) {\n      e.stopImmediatePropagation();\n    } else if (select.isOpen && select.highlighted !== undefined) {\n      e.stopImmediatePropagation();\n      e.preventDefault(); // Prevents scrolling of the page.\n      select.actions.choose(select.highlighted, e);\n    }\n  }\n\n  _handleKeyUpDown(select: Select, e: KeyboardEvent): void {\n    if (select.isOpen) {\n      e.preventDefault();\n      e.stopPropagation();\n      const step: 1 | -1 = e.keyCode === 40 ? 1 : -1;\n      const newHighlighted = advanceSelectableOption(\n        select.results,\n        select.highlighted,\n        step,\n      );\n      select.actions.highlight(newHighlighted);\n      select.actions.scrollTo(newHighlighted);\n    } else {\n      select.actions.open(e);\n    }\n  }\n\n  _resetHighlighted(): void {\n    let highlighted;\n    const defHighlighted = this.args.defaultHighlighted || defaultHighlighted;\n    if (typeof defHighlighted === 'function') {\n      highlighted = defHighlighted({\n        results: this.results,\n        highlighted: this.highlighted,\n        selected: this.selected,\n      });\n    } else {\n      highlighted = defHighlighted;\n    }\n    this._highlight(highlighted);\n  }\n\n  _filter(options: any[], term: string, skipDisabled = false): any[] {\n    const matcher = this.args.matcher || defaultMatcher;\n    const optionMatcher = getOptionMatcher(\n      matcher,\n      defaultMatcher,\n      this.args.searchField,\n    );\n    return filterOptions(options || [], term, optionMatcher, skipDisabled);\n  }\n\n  _updateIsActive(value: boolean) {\n    this.isActive = value;\n  }\n\n  findWithOffset(\n    options: readonly any[],\n    term: string,\n    offset: number,\n    skipDisabled = false,\n  ): any {\n    const typeAheadOptionMatcher = getOptionMatcher(\n      this.args.typeAheadOptionMatcher || defaultTypeAheadMatcher,\n      defaultTypeAheadMatcher,\n      this.args.searchField,\n    );\n    return findOptionWithOffset(\n      options || [],\n      term,\n      typeAheadOptionMatcher,\n      offset,\n      skipDisabled,\n    );\n  }\n\n  // Tasks\n  triggerTypingTask = restartableTask(async (e: KeyboardEvent) => {\n    // In general, a user doing this interaction means to have a different result.\n    let searchStartOffset = 1;\n    let repeatingChar = this._repeatingChar;\n    let charCode = e.keyCode;\n    if (isNumpadKeyEvent(e)) {\n      charCode -= 48; // Adjust char code offset for Numpad key codes. Check here for numapd key code behavior: https://goo.gl/Qwc9u4\n    }\n    let term;\n\n    // Check if user intends to cycle through results. _repeatingChar can only be the first character.\n    const c = String.fromCharCode(charCode);\n    if (c === this._repeatingChar) {\n      term = c;\n    } else {\n      term = this._expirableSearchText + c;\n    }\n\n    if (term.length > 1) {\n      // If the term is longer than one char, the user is in the middle of a non-cycling interaction\n      // so the offset is just zero (the current selection is a valid match).\n      searchStartOffset = 0;\n      repeatingChar = '';\n    } else {\n      repeatingChar = c;\n    }\n\n    // When the select is open, the \"selection\" is just highlighted.\n    if (this.storedAPI.isOpen && this.storedAPI.highlighted) {\n      searchStartOffset += indexOfOption(\n        this.storedAPI.options,\n        this.storedAPI.highlighted,\n      );\n    } else if (!this.storedAPI.isOpen && !isNone(this.selected)) {\n      searchStartOffset += indexOfOption(this.storedAPI.options, this.selected);\n    } else {\n      searchStartOffset = 0;\n    }\n\n    // The char is always appended. That way, searching for words like \"Aaron\" will work even\n    // if \"Aa\" would cycle through the results.\n    this._expirableSearchText = this._expirableSearchText + c;\n    this._repeatingChar = repeatingChar;\n    const match = this.findWithOffset(\n      this.storedAPI.options,\n      term,\n      searchStartOffset,\n      true,\n    );\n    if (match !== undefined) {\n      if (this.storedAPI.isOpen) {\n        this.storedAPI.actions.highlight(match);\n        this.storedAPI.actions.scrollTo(match);\n      } else {\n        this.storedAPI.actions.select(match, e);\n      }\n    }\n    await timeout(1000);\n    this._expirableSearchText = '';\n    this._repeatingChar = '';\n  });\n}\n\nfunction getOptionMatcher(\n  matcher: MatcherFn,\n  defaultMatcher: MatcherFn,\n  searchField: string | undefined,\n): MatcherFn {\n  if (searchField && matcher === defaultMatcher) {\n    return (option: any, text: string) =>\n      matcher(get(option, searchField), text);\n  } else {\n    return (option: any, text: string) => {\n      assert(\n        '<PowerSelect> If you want the default filtering to work on options that are not plain strings, you need to provide `@searchField`',\n        matcher !== defaultMatcher || typeof option === 'string',\n      );\n      return matcher(option, text);\n    };\n  }\n}\n\nfunction isNumpadKeyEvent(e: KeyboardEvent): boolean {\n  return e.keyCode >= 96 && e.keyCode <= 105;\n}\n\nconst toPlainArray = <T>(collection: T[] | Sliceable<T>): T[] => {\n  if (isSliceable<T>(collection)) {\n    return collection.slice();\n  } else {\n    return collection;\n  }\n};\n"],"names":["isSliceable","coll","isArray","isPromiseLike","thing","then","isPromiseProxyLike","Object","hasOwnProperty","call","isCancellablePromise","cancel","PowerSelectComponent","Component","_publicAPIActions","search","_search","highlight","_highlight","select","_select","choose","_choose","scrollTo","_scrollTo","labelClick","_labelClick","g","prototype","tracked","i","void 0","storedAPI","_uid","guidFor","_lastOptionsPromise","_lastSelectedPromise","_lastSearchPromise","_filterResultsCache","results","options","searchText","constructor","owner","args","assert","onChange","willDestroy","removeObserver","_selectedObserverCallback","undefined","highlightOnHover","labelClickAction","highlightedIndex","highlighted","pathForOption","searchMessage","noMatchesMessage","resultCountMessage","resultsCount","matchTriggerWidth","mustShowSearchMessage","loading","length","mustShowNoMessages","lastSearchedText","toPlainArray","_searchResult","_filter","_resolvedOptions","countOptions","selected","_resolvedSelected","isNone","ariaMultiSelectable","triggerId","labelId","ariaLabelledBy","labelText","labelComponent","handleOpen","e","onOpen","KeyboardEvent","type","keyCode","preventDefault","_resetHighlighted","n","action","handleClose","onClose","handleInput","target","term","value","correctedTerm","onInput","handleKeydown","onKeydown","_routeKeydown","handleTriggerKeydown","stopImmediatePropagation","ctrlKey","metaKey","isNumpadKeyEvent","triggerTypingTask","perform","_handleKeySpace","event","detail","actions","open","trigger","document","querySelector","uniqueId","focus","handleFocus","isDestroying","scheduleTask","_updateIsActive","onFocus","handleBlur","onBlur","_updateOptions","deprecate","for","id","since","enabled","available","until","__updateOptions","_updateHighlighted","isOpen","_updateSelected","__updateSelected","opt","disabled","isEqual","selection","buildSelection","closeOnSelect","close","option","optionsList","getElementById","index","indexOfOption","optionElement","optionTopScroll","offsetTop","optionBottomScroll","offsetHeight","scrollTop","_registerAPI","triggerElement","publicAPI","__registerAPI","_performSearch","__performSearch","updateOptions","modifier","eager","updateSelected","updateRegisterAPI","updatePerformSearch","currentOptionsPromise","resolvedOptions","catch","currentSelectedPromise","isDestroyed","addObserver","resolvedSelected","Array","_","registerAPI","searchResult","_defaultBuildSelection","_handleKeyUpDown","_handleKeyEnter","_handleKeyTab","_handleKeyESC","includes","nodeName","stopPropagation","step","newHighlighted","advanceSelectableOption","defHighlighted","defaultHighlighted","skipDisabled","matcher","defaultMatcher","optionMatcher","getOptionMatcher","searchField","filterOptions","isActive","findWithOffset","offset","typeAheadOptionMatcher","defaultTypeAheadMatcher","findOptionWithOffset","_buildTask","context","generator","searchStartOffset","repeatingChar","_repeatingChar","charCode","c","String","fromCharCode","_expirableSearchText","match","timeout","text","get","collection","slice","setComponentTemplate","TEMPLATE"],"mappings":"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"}